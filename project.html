<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EduSafe — Digital Disaster Preparedness</title>
  <meta name="description" content="EduSafe: Disaster preparedness training for schools and colleges." />
  <!-- Tailwind CDN for fast prototyping -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Small custom tweaks */
    .glass {
      backdrop-filter: blur(6px);
      background: rgba(255,255,255,0.6);
    }
    /* simple animation for drill steps */
    .step-enter {
      transform: translateY(8px);
      opacity: 0;
    }
    .step-enter-active {
      transform: translateY(0);
      opacity: 1;
      transition: all 280ms ease;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-sky-50 to-white text-slate-800">
  <!-- Navbar -->
  <header class="w-full sticky top-0 z-30 bg-white/60 backdrop-blur border-b">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="rounded-full bg-red-500 text-white w-10 h-10 flex items-center justify-center font-bold">ES</div>
        <div>
          <h1 class="text-lg font-semibold">EduSafe</h1>
          <p class="text-xs text-slate-600">Digital Disaster Preparedness</p>
        </div>
      </div>
      <nav class="hidden md:flex items-center space-x-3 text-sm">
        <a href="#modules" class="hover:underline">Modules</a>
        <a href="#drill" class="hover:underline">Virtual Drill</a>
        <a href="#quiz" class="hover:underline">Quiz</a>
        <a href="#admin" class="hover:underline">Admin</a>
        <button id="loginToggle" class="px-3 py-1 rounded bg-sky-600 text-white text-sm">Mock Login</button>
      </nav>

      <!-- mobile menu -->
      <div class="md:hidden">
        <button id="mobileOpen" class="p-2 rounded hover:bg-slate-100">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>
    <!-- mobile nav -->
    <div id="mobileNav" class="hidden md:hidden border-t bg-white/60">
      <div class="px-4 py-3 flex flex-col space-y-2">
        <a href="#modules" class="hover:underline">Modules</a>
        <a href="#drill" class="hover:underline">Virtual Drill</a>
        <a href="#quiz" class="hover:underline">Quiz</a>
        <a href="#admin" class="hover:underline">Admin</a>
        <button id="mobileLogin" class="px-3 py-1 rounded bg-sky-600 text-white text-sm w-max">Mock Login</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <main class="max-w-6xl mx-auto px-4 py-10">
    <section class="grid md:grid-cols-2 gap-8 items-center">
      <div>
        <h2 class="text-3xl md:text-4xl font-extrabold leading-tight">Be Prepared. Stay Safe.</h2>
        <p class="mt-4 text-slate-700">Interactive disaster preparedness modules, virtual drills, emergency toolkit and an admin dashboard for schools and colleges — responsive for PC and mobile.</p>

        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#modules" class="inline-block px-5 py-3 bg-sky-600 text-white rounded-lg">Start Learning</a>
          <a href="#drill" class="inline-block px-5 py-3 border rounded-lg">Run Virtual Drill</a>
          <a href="#quiz" class="inline-block px-5 py-3 border rounded-lg">Take Quiz</a>
        </div>

        <div class="mt-6 grid grid-cols-2 gap-3 text-sm">
          <div class="p-3 rounded-lg glass border">
            <div class="font-semibold">Region Alerts</div>
            <div class="text-xs text-slate-600">Show local advisory (demo)</div>
          </div>
          <div class="p-3 rounded-lg glass border">
            <div class="font-semibold">Emergency Toolkit</div>
            <div class="text-xs text-slate-600">SOS, Contacts, Evacuation map</div>
          </div>
        </div>
      </div>

      <div class="p-6 bg-white rounded-2xl shadow-sm">
        <img src="https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=73b1a6b7b390c7bd6e7dbb4ddf8f7b04" alt="safety" class="w-full h-56 object-cover rounded-lg" />
        <div class="mt-4 text-sm text-slate-600">Demo site — data is stored locally in your browser for the hackathon prototype.</div>
      </div>
    </section>

    <!-- Modules -->
    <section id="modules" class="mt-12">
      <h3 class="text-2xl font-semibold">Learning Modules</h3>
      <p class="text-slate-600 mt-2">Choose a topic and complete the module to earn points and badges.</p>

      <div class="mt-6 grid md:grid-cols-2 gap-6">
        <!-- Earthquake Module -->
        <article class="p-4 bg-white rounded-lg border shadow-sm">
          <div class="flex items-start gap-3">
            <div class="w-12 h-12 flex items-center justify-center rounded bg-yellow-100 text-yellow-800 font-bold">EQ</div>
            <div>
              <h4 class="font-semibold">Earthquake Safety</h4>
              <p class="text-sm text-slate-600">What to do during tremors: Drop, Cover, Hold On, then Evacuate.</p>
              <div class="mt-3 flex gap-2">
                <button class="moduleOpen px-3 py-1 rounded bg-sky-600 text-white text-sm" data-module="earthquake">Open Module</button>
                <button class="px-3 py-1 border rounded text-sm" data-module="earthquake">Preview</button>
              </div>
            </div>
          </div>
        </article>

        <!-- Fire Module -->
        <article class="p-4 bg-white rounded-lg border shadow-sm">
          <div class="flex items-start gap-3">
            <div class="w-12 h-12 flex items-center justify-center rounded bg-red-100 text-red-700 font-bold">FIRE</div>
            <div>
              <h4 class="font-semibold">Fire Safety</h4>
              <p class="text-sm text-slate-600">Evacuate calmly, stop-drop-roll if clothes catch fire, follow exit routes.</p>
              <div class="mt-3 flex gap-2">
                <button class="moduleOpen px-3 py-1 rounded bg-sky-600 text-white text-sm" data-module="fire">Open Module</button>
                <button class="px-3 py-1 border rounded text-sm" data-module="fire">Preview</button>
              </div>
            </div>
          </div>
        </article>
      </div>
    </section>

    <!-- Drill section -->
    <section id="drill" class="mt-12">
      <h3 class="text-2xl font-semibold">Virtual Drill Simulator</h3>
      <p class="text-slate-600 mt-2">Run a guided drill — follow the steps and select the correct action.</p>

      <div class="mt-6 grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 p-4 bg-white rounded-lg border">
          <label class="text-sm text-slate-600">Choose drill</label>
          <select id="drillSelect" class="mt-2 px-3 py-2 border rounded w-full">
            <option value="earthquake">Earthquake Drill (Classroom)</option>
            <option value="fire">Fire Drill (Library)</option>
          </select>

          <div id="drillArea" class="mt-4">
            <!-- steps will be injected here -->
            <div class="p-4 bg-slate-50 rounded text-sm text-slate-600">Select a drill and click <strong>Start Drill</strong>.</div>
          </div>

          <div class="mt-4 flex gap-3">
            <button id="startDrill" class="px-4 py-2 bg-emerald-600 text-white rounded">Start Drill</button>
            <button id="resetDrill" class="px-4 py-2 border rounded">Reset</button>
          </div>
        </div>

        <aside class="p-4 bg-white rounded-lg border">
          <div class="font-semibold">Drill Info</div>
          <div class="mt-3 text-sm text-slate-600">This simulation is for training and demonstration. In production, connect to admin scheduling and real alert sources.</div>
          <div class="mt-3">
            <div class="text-xs text-slate-500">Participation (local demo)</div>
            <div id="participationCount" class="text-2xl font-bold">0</div>
          </div>
        </aside>
      </div>
    </section>

    <!-- Quiz -->
    <section id="quiz" class="mt-12">
      <h3 class="text-2xl font-semibold">Gamified Quiz</h3>
      <p class="text-slate-600 mt-2">Earn points and collect badges. Scores are saved in your browser for demo purposes.</p>

      <div class="mt-6 grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 p-4 bg-white rounded-lg border">
          <div id="quizArea">
            <div class="text-sm text-slate-600">Click Start Quiz to begin.</div>
            <div class="mt-4">
              <button id="startQuiz" class="px-4 py-2 bg-sky-600 text-white rounded">Start Quiz</button>
            </div>
          </div>
        </div>

        <aside class="p-4 bg-white rounded-lg border">
          <div class="font-semibold">Your Score</div>
          <div class="mt-2 text-3xl font-bold" id="userScore">0</div>
          <div class="mt-3 text-sm text-slate-600">Badges earned:</div>
          <div id="badges" class="mt-2 flex gap-2 flex-wrap"></div>
        </aside>
      </div>
    </section>

    <!-- Admin -->
    <section id="admin" class="mt-12 mb-28">
      <h3 class="text-2xl font-semibold">Admin Dashboard (Demo)</h3>
      <p class="text-slate-600 mt-2">Mock admin view that reads participation & scores saved to localStorage.</p>

      <div class="mt-6 p-4 bg-white rounded-lg border">
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
          <div>
            <label class="text-sm text-slate-600">Admin name</label>
            <input id="adminName" placeholder="Enter admin name" class="mt-2 px-3 py-2 border rounded w-full md:w-64" />
          </div>

          <div class="flex gap-3">
            <button id="exportData" class="px-4 py-2 border rounded">Export Demo Data</button>
            <button id="clearData" class="px-4 py-2 bg-red-600 text-white rounded">Clear Demo Data</button>
          </div>
        </div>

        <div class="mt-6 overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="text-left text-slate-600">
              <tr>
                <th class="pb-2">User</th>
                <th class="pb-2">Score</th>
                <th class="pb-2">Badges</th>
                <th class="pb-2">Last Drill</th>
              </tr>
            </thead>
            <tbody id="adminTable" class="align-top"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Emergency toolkit footer -->
  <footer class="fixed bottom-4 right-4 left-4 md:right-8 md:left-auto md:bottom-8 z-50">
    <div class="max-w-6xl mx-auto">
      <div class="flex items-center justify-between gap-4 p-3 bg-white border rounded-xl shadow-lg">
        <div class="flex items-center gap-3">
          <button id="sosBtn" title="SOS" class="w-12 h-12 rounded-full bg-red-600 text-white font-bold">SOS</button>
          <div>
            <div class="text-sm font-semibold">Emergency Toolkit</div>
            <div class="text-xs text-slate-600">Mock contacts & evacuation tips</div>
          </div>
        </div>
        <div class="hidden sm:flex gap-3 items-center">
          <div class="text-sm text-slate-600">Fire: 101 · Ambulance: 102 · Police: 100</div>
          <button id="evacMap" class="px-3 py-1 border rounded text-sm">Evacuation Map</button>
        </div>
      </div>
    </div>
  </footer>

  <!-- SOS Modal -->
  <div id="sosModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 z-60">
    <div class="bg-white rounded-lg p-6 w-11/12 md:w-96 text-center">
      <h4 class="text-xl font-semibold">SOS — Emergency</h4>
      <p class="mt-3 text-slate-600">This is a demo SOS. In a production system, this would notify school admins, parents and emergency services.</p>
      <div class="mt-4 flex justify-center gap-3">
        <button id="confirmSOS" class="px-4 py-2 bg-red-600 text-white rounded">Send Alert</button>
        <button id="closeSOS" class="px-4 py-2 border rounded">Close</button>
      </div>
    </div>
  </div>

  <!-- Module Modal -->
  <div id="moduleModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 z-60">
    <div class="bg-white rounded-lg p-6 w-11/12 md:w-3/4 max-h-[85vh] overflow-auto">
      <button id="closeModule" class="text-slate-500 float-right">Close ✕</button>
      <div id="moduleContent" class="mt-4"></div>
    </div>
  </div>

  <script>
    // ====== Utility & Demo data ======
    const sampleModules = {
      earthquake: {
        title: "Earthquake Safety",
        intro: "During tremors: Drop, Cover, Hold On. Then evacuate to open ground if safe.",
        steps: [
          { text: "Drop to your knees immediately", correct: true },
          { text: "Run outside right away", correct: false },
          { text: "Take cover under a sturdy table or desk", correct: true },
          { text: "Hold on until shaking stops", correct: true },
          { text: "Use elevator to evacuate", correct: false }
        ],
        quiz: [
          { q: "Best immediate action during a quake in a classroom?", a: ["Run outside","Duck & Cover","Call home"], correct: 1 },
          { q: "Should you use elevator during shaking?", a: ["Yes","No"], correct: 1 }
        ]
      },
      fire: {
        title: "Fire Safety",
        intro: "Alert others, use nearest exit, stop-drop-roll if clothes catch fire, don't use lifts.",
        steps: [
          { text: "Raise alarm and inform teacher", correct: true },
          { text: "Open windows and stay in room", correct: false },
          { text: "Follow evacuation routes calmly", correct: true },
          { text: "Stop, Drop and Roll if clothes catch fire", correct: true }
        ],
        quiz: [
          { q: "If clothing catches fire, you should:", a: ["Run","Stop, Drop & Roll","Stand still"], correct: 1 },
          { q: "Should you use an elevator during a fire?", a: ["Yes","No"], correct: 1 }
        ]
      }
    };

    // localStorage keys
    const SCORE_KEY = "edusafe_score";
    const BADGES_KEY = "edusafe_badges";
    const PARTIC_KEY = "edusafe_participation";
    const USER_KEY = "edusafe_user";

    // ====== Mobile nav toggle ======
    document.getElementById("mobileOpen").addEventListener("click", () => {
      document.getElementById("mobileNav").classList.toggle("hidden");
    });

    // ====== Mock login toggle ======
    function mockLogin() {
      const user = localStorage.getItem(USER_KEY) || null;
      if (!user) {
        const name = prompt("Enter your name for demo (no sign-up):", "Student A");
        if (name) {
          localStorage.setItem(USER_KEY, JSON.stringify({ name, registeredAt: Date.now() }));
          alert("Mock login successful as " + name);
        }
      } else {
        if (confirm("Logout demo user?")) {
          localStorage.removeItem(USER_KEY);
          alert("Logged out.");
        }
      }
      renderUserState();
      populateAdminTable();
    }
    document.getElementById("loginToggle").addEventListener("click", mockLogin);
    document.getElementById("mobileLogin").addEventListener("click", mockLogin);

    function renderUserState() {
      const u = JSON.parse(localStorage.getItem(USER_KEY) || "null");
      const btns = document.querySelectorAll("#loginToggle, #mobileLogin");
      btns.forEach(b => {
        b.textContent = u ? ("User: " + u.name) : "Mock Login";
      });
      // show badges & score
      document.getElementById("userScore").textContent = localStorage.getItem(SCORE_KEY) || 0;
      renderBadges();
    }

    // ====== Module modal ======
    const moduleModal = document.getElementById("moduleModal");
    const moduleContent = document.getElementById("moduleContent");
    document.querySelectorAll(".moduleOpen").forEach(btn => {
      btn.addEventListener("click", () => openModule(btn.dataset.module));
    });

    function openModule(key) {
      const mod = sampleModules[key];
      moduleContent.innerHTML = "";
      const title = document.createElement("h3"); title.className = "text-xl font-semibold"; title.textContent = mod.title;
      const intro = document.createElement("p"); intro.className = "mt-2 text-slate-600"; intro.textContent = mod.intro;
      moduleContent.appendChild(title); moduleContent.appendChild(intro);

      const stepWrap = document.createElement("div"); stepWrap.className = "mt-4 space-y-2";
      mod.steps.forEach((s, i) => {
        const el = document.createElement("div");
        el.className = "p-3 bg-slate-50 rounded flex items-center justify-between";
        el.innerHTML = `<div class="text-sm">${i+1}. ${s.text}</div><button data-step="${i}" class="markStep px-3 py-1 text-sm rounded border">Mark correct</button>`;
        stepWrap.appendChild(el);
      });
      moduleContent.appendChild(stepWrap);

      // quiz preview
      const qWrap = document.createElement("div"); qWrap.className = "mt-4";
      qWrap.innerHTML = `<div class="font-semibold">Module Quiz Preview</div>`;
      mod.quiz.forEach((q, idx) => {
        const qEl = document.createElement("div"); qEl.className = "mt-2 text-sm";
        qEl.textContent = `Q${idx+1}: ${q.q} (${q.a.join(" / ")})`;
        qWrap.appendChild(qEl);
      });
      moduleContent.appendChild(qWrap);

      // complete button
      const completeBtn = document.createElement("button");
      completeBtn.className = "mt-4 px-4 py-2 bg-emerald-600 text-white rounded";
      completeBtn.textContent = "Complete Module & Earn Points";
      completeBtn.addEventListener("click", () => {
        awardScore(20);
        addBadge(mod.title);
        alert("Module completed! +20 points");
        moduleModal.classList.add("hidden");
      });
      moduleContent.appendChild(completeBtn);

      moduleModal.classList.remove("hidden");
    }

    document.getElementById("closeModule").addEventListener("click", () => moduleModal.classList.add("hidden"));

    // ====== Drill simulator ======
    const drillArea = document.getElementById("drillArea");
    const startDrillBtn = document.getElementById("startDrill");
    const resetDrillBtn = document.getElementById("resetDrill");
    const participationCountEl = document.getElementById("participationCount");

    function renderDrill(drillKey) {
      const drill = sampleModules[drillKey];
      drillArea.innerHTML = "";
      const card = document.createElement("div");
      card.className = "p-4 rounded bg-slate-50";
      const title = document.createElement("div"); title.className = "font-semibold"; title.textContent = drill.title + " — Drill";
      card.appendChild(title);

      const stepsEl = document.createElement("div"); stepsEl.className = "mt-3 space-y-3";
      drill.steps.forEach((s, i) => {
        const sbox = document.createElement("div");
        sbox.className = "p-3 bg-white border rounded flex items-center justify-between";
        sbox.innerHTML = `<div class="text-sm">${i+1}. ${s.text}</div>
          <div>
            <button class="chooseStep px-3 py-1 text-sm rounded border" data-i="${i}">Choose</button>
          </div>`;
        stepsEl.appendChild(sbox);
      });
      card.appendChild(stepsEl);

      // result area
      const result = document.createElement("div"); result.id = "drillResult"; result.className = "mt-4 text-sm text-slate-600";
      card.appendChild(result);

      drillArea.appendChild(card);

      // bind choose buttons
      drillArea.querySelectorAll(".chooseStep").forEach(btn => {
        btn.addEventListener("click", (ev) => {
          const idx = Number(btn.dataset.i);
          const chosen = drill.steps[idx];
          if (chosen.correct) {
            result.textContent = "Correct action. Keep going.";
            awardScore(5);
          } else {
            result.textContent = "Not the best action. Review the safety steps.";
          }
        });
      });
    }

    startDrillBtn.addEventListener("click", () => {
      const key = document.getElementById("drillSelect").value;
      renderDrill(key);
      incrementParticipation();
    });

    resetDrillBtn.addEventListener("click", () => { drillArea.innerHTML = '<div class="p-4 bg-slate-50 rounded text-sm text-slate-600">Select a drill and click <strong>Start Drill</strong>.</div>'; });

    // participation tracking
    function incrementParticipation() {
      const p = Number(localStorage.getItem(PARTIC_KEY) || 0) + 1;
      localStorage.setItem(PARTIC_KEY, p);
      renderParticipation();
      populateAdminTable();
    }
    function renderParticipation() {
      const p = localStorage.getItem(PARTIC_KEY) || 0;
      participationCountEl.textContent = p;
    }

    // ====== Quiz ======
    const quizArea = document.getElementById("quizArea");
    document.getElementById("startQuiz").addEventListener("click", () => startQuiz());

    function startQuiz() {
      const moduleKeys = Object.keys(sampleModules);
      // combine all quizzes
      const allQ = [];
      moduleKeys.forEach(k => {
        sampleModules[k].quiz.forEach(q => { allQ.push({ ...q, module: k }); });
      });
      // simple 3-question quiz for demo
      const questions = allQ.slice(0, 3);
      let idx = 0, score = 0;
      quizArea.innerHTML = "";
      const qBox = document.createElement("div");
      qBox.className = "p-4 bg-slate-50 rounded";
      quizArea.appendChild(qBox);

      function showQuestion() {
        qBox.innerHTML = "";
        if (idx >= questions.length) {
          qBox.innerHTML = `<div class="text-sm">Quiz complete! You scored ${score} / ${questions.length}</div>`;
          awardScore(score * 10);
          if (score === questions.length) addBadge("Quiz Master");
          renderUserState();
          populateAdminTable();
          return;
        }
        const q = questions[idx];
        const qTitle = document.createElement("div"); qTitle.className = "font-semibold"; qTitle.textContent = `Q${idx+1}: ${q.q}`;
        qBox.appendChild(qTitle);
        const opts = document.createElement("div"); opts.className = "mt-3 flex flex-col gap-2";
        q.a.forEach((opt, i) => {
          const b = document.createElement("button");
          b.className = "px-3 py-2 text-left border rounded text-sm";
          b.textContent = opt;
          b.addEventListener("click", () => {
            if (i === q.correct) {
              score++;
              b.classList.add("bg-emerald-50", "border-emerald-300");
            } else {
              b.classList.add("bg-red-50", "border-red-300");
            }
            idx++;
            setTimeout(showQuestion, 700);
          });
          opts.appendChild(b);
        });
        qBox.appendChild(opts);
      }
      showQuestion();
    }

    // ====== Scoring & badges ======
    function awardScore(n) {
      const cur = Number(localStorage.getItem(SCORE_KEY) || 0);
      localStorage.setItem(SCORE_KEY, cur + n);
      renderUserState();
    }

    function addBadge(name) {
      const b = JSON.parse(localStorage.getItem(BADGES_KEY) || "[]");
      if (!b.includes(name)) {
        b.push(name);
        localStorage.setItem(BADGES_KEY, JSON.stringify(b));
      }
      renderBadges();
    }

    function renderBadges() {
      const container = document.getElementById("badges");
      const b = JSON.parse(localStorage.getItem(BADGES_KEY) || "[]");
      container.innerHTML = "";
      if (b.length === 0) {
        container.innerHTML = '<div class="text-xs text-slate-500">No badges yet</div>';
        return;
      }
      b.forEach(x => {
        const el = document.createElement("div");
        el.className = "px-2 py-1 text-xs border rounded bg-yellow-50";
        el.textContent = x;
        container.appendChild(el);
      });
      document.getElementById("userScore").textContent = localStorage.getItem(SCORE_KEY) || 0;
    }

    // ====== Admin table & export ======
    function populateAdminTable() {
      const tbody = document.getElementById("adminTable");
      tbody.innerHTML = "";
      // demo model: single demo user from localStorage
      const user = JSON.parse(localStorage.getItem(USER_KEY) || "null");
      const score = localStorage.getItem(SCORE_KEY) || 0;
      const badges = JSON.parse(localStorage.getItem(BADGES_KEY) || "[]");
      const lastDrill = localStorage.getItem(PARTIC_KEY) || 0;
      if (user) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td class="py-2">${user.name}</td><td class="py-2">${score}</td><td class="py-2">${badges.join(", ")}</td><td class="py-2">${lastDrill}</td>`;
        tbody.appendChild(tr);
      } else {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td class="py-2 text-slate-500" colspan="4">No demo users logged in. Use Mock Login to register a demo user.</td>`;
        tbody.appendChild(tr);
      }
    }

    document.getElementById("exportData").addEventListener("click", () => {
      const payload = {
        user: JSON.parse(localStorage.getItem(USER_KEY) || "null"),
        score: localStorage.getItem(SCORE_KEY) || 0,
        badges: JSON.parse(localStorage.getItem(BADGES_KEY) || "[]"),
        participation: localStorage.getItem(PARTIC_KEY) || 0
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "edusafe_demo_data.json"; a.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById("clearData").addEventListener("click", () => {
      if (!confirm("Clear all demo data from this browser?")) return;
      localStorage.removeItem(SCORE_KEY);
      localStorage.removeItem(BADGES_KEY);
      localStorage.removeItem(PARTIC_KEY);
      localStorage.removeItem(USER_KEY);
      renderUserState();
      populateAdminTable();
    });

    // ====== Emergency / SOS handlers ======
    const sosModal = document.getElementById("sosModal");
    document.getElementById("sosBtn").addEventListener("click", () => sosModal.classList.remove("hidden"));
    document.getElementById("closeSOS").addEventListener("click", () => sosModal.classList.add("hidden"));
    document.getElementById("confirmSOS").addEventListener("click", () => {
      sosModal.classList.add("hidden");
      alert("Demo alert sent to school admin & parents (mock).");
    });

    document.getElementById("evacMap").addEventListener("click", () => {
      alert("Evacuation map placeholder — upload facility available in Admin panel (demo).");
    });

    // ====== On load ======
    renderUserState();
    renderParticipation();
    populateAdminTable();
    
</script>
</body>
</html>
